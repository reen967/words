<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UARL | Full Affective Compiler & Transition Matrix</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #eee; display: flex; height: 100vh; margin: 0; }
        #sidebar { width: 380px; background: #151515; padding: 25px; border-right: 1px solid #333; overflow-y: auto; }
        #viewer { flex-grow: 1; padding: 40px; display: flex; flex-direction: column; }
        .card { background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
        .code-block { background: #000; color: #0f0; padding: 20px; border-radius: 8px; flex-grow: 1; overflow: auto; font-family: 'Fira Code', monospace; font-size: 12px; border: 1px solid #00ff0033; }
        .btn { width: 100%; padding: 12px; background: #0066ff; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn:hover { background: #0052cc; transform: translateY(-2px); }
        h2 { font-size: 1rem; color: #0066ff; text-transform: uppercase; letter-spacing: 1px; }
        input[type="checkbox"] { margin-right: 10px; accent-color: #0066ff; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>1. Hardware Profile</h2>
    <div class="card">
        <input type="text" id="botName" value="UARL_AGENT_BETA" style="width:100%; background:#333; color:#fff; border:none; padding:8px; border-radius:4px; margin-bottom:15px;">
        <label><input type="checkbox" id="has_rotation" checked> Kinetic Rotation</label><br>
        <label><input type="checkbox" id="has_sound" checked> Acoustic Volume</label><br>
        <label><input type="checkbox" id="has_light"> Luminous Intensity</label>
    </div>

    <h2>2. Psychophysical Bounds</h2>
    <div class="card">
        <small>Weber Constant (Sensitivity):</small>
        <input type="range" id="weber_sense" min="1" max="20" value="5" style="width:100%;">
    </div>

    <button class="btn" onclick="compileAll()">GENERATE SYSTEM</button>
    <button class="btn" style="background:#222; border:1px solid #444;" onclick="downloadFullPackage()">DOWNLOAD ZIP/JSON</button>
</div>

<div id="viewer">
    <h2>System Output (Capability-Agnostic Language)</h2>
    <div class="code-block" id="outputConsole">// INITIALIZE SYSTEM TO SEE COMPILED LOGIC...</div>
</div>

<script src="affective_data.js"></script>
<script>
    const MODALITIES = {
        "rotation": { exponent: 1.0, weber: 0.05, unit: "deg/s" },
        "sound": { exponent: 0.6, weber: 0.10, unit: "dB" },
        "light": { exponent: 0.33, weber: 0.02, unit: "lux" }
    };

    let compiledSystem = null;

    function compileAll() {
        const hardware = [];
        if(document.getElementById('has_rotation').checked) hardware.push('rotation');
        if(document.getElementById('has_sound').checked) hardware.push('sound');
        if(document.getElementById('has_light').checked) hardware.push('light');

        compiledSystem = {
            metadata: {
                agent: document.getElementById('botName').value,
                logic: "UARL-V2-Agnostic",
                modalities_count: hardware.length
            },
            dictionary: AFFECTIVE_DATA.map(emo => {
                let impl = {};
                hardware.forEach(h => {
                    const spec = MODALITIES[h];
                    const intensity = Math.pow(emo.p, 1 / spec.exponent);
                    impl[h] = {
                        noun_intensity: intensity.toFixed(4),
                        verb_logic: (emo.angle > 45 && emo.angle < 135) ? "Snap" : "Glide",
                        jitter: (1 - emo.p).toFixed(3)
                    };
                });
                return { word: emo.name, vector: [emo.angle, emo.p], hardware: impl };
            }),
            transitions: generateTransitionMatrix()
        };

        document.getElementById('outputConsole').textContent = JSON.stringify(compiledSystem, null, 2);
    }

    function generateTransitionMatrix() {
        // Defines the "Verbs" used to move between major Affective Quadrants
        return {
            "CALM_TO_ALARM": { verb: "Snap", formula: "y = t^2", duration: "120ms" },
            "ALARM_TO_SAD": { verb: "Decel", formula: "y = sqrt(t)", duration: "900ms" },
            "NEUTRAL_TO_HAPPY": { verb: "Surge", formula: "y = t^4", duration: "400ms" }
        };
    }

    function downloadFullPackage() {
        if(!compiledSystem) return alert("Please compile first.");
        const blob = new Blob([JSON.stringify(compiledSystem, null, 2)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${compiledSystem.metadata.agent}_CORE.json`;
        a.click();
    }
</script>
</body>
</html>
