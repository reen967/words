<!DOCTYPE html>
<html>
<head>
    <title>Robot Language Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; }
        .controls { padding: 20px; background: #333; border-radius: 8px; margin: 20px; }
        .stage { display: flex; gap: 50px; margin-top: 30px; align-items: center; height: 200px; }
        #light { width: 80px; height: 80px; border-radius: 50%; background: #fff; box-shadow: 0 0 20px #fff; }
        #box { width: 80px; height: 80px; background: #666; border: 2px solid #999; }
        #chart-container { width: 800px; height: 300px; background: #000; padding: 10px; }
    </style>
</head>
<body>
    <h2>Affective Robot Language Engine</h2>
    
    <div class="controls">
        Start Noun: <select id="startNoun"></select>
        Verb: <select id="verb"></select>
        End Noun: <select id="endNoun"></select>
        <button onclick="playSentence()">Play Sentence</button>
    </div>

    <div id="chart-container"><canvas id="waveChart"></canvas></div>

    <div class="stage">
        <div><p>Light Antenna</p><div id="light"></div></div>
        <div><p>Kinetic Antenna</p><div id="box"></div></div>
    </div>

    <script src="dictionary.js"></script>
    <script>
        // Populate Selects
        const nSel1 = document.getElementById('startNoun');
        const nSel2 = document.getElementById('endNoun');
        const vSel = document.getElementById('verb');

        Object.keys(Dictionary.nouns).forEach(n => {
            nSel1.add(new Option(n, n));
            nSel2.add(new Option(n, n));
        });
        Object.keys(Dictionary.verbs).forEach(v => vSel.add(new Option(v, v)));

        // Setup Chart
        const ctx = document.getElementById('waveChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: Array.from({length: 100}, (_, i) => i), datasets: [{ label: 'Î¨ Signal', data: [], borderColor: '#00ffcc', borderWidth: 2, pointRadius: 0 }] },
            options: { animation: false, scales: { y: { min: -1.5, max: 1.5 } } }
        });

        let animationId;
        function playSentence() {
            if (animationId) cancelAnimationFrame(animationId);
            
            const n1 = Dictionary.nouns[nSel1.value];
            const n2 = Dictionary.nouns[nSel2.value];
            const verb = Dictionary.verbs[vSel.value];
            
            let startTime = performance.now();
            const duration = 2000; // 2 seconds transition

            function animate(now) {
                let t = (now - startTime) / duration;
                if (t > 1) t = 1;

                const u = verb(t);
                
                // Angular Pathing
                let dTheta = n2.theta - n1.theta;
                if (dTheta > 180) dTheta -= 360;
                if (dTheta < -180) dTheta += 360;
                
                const currentTheta = n1.theta + (dTheta * u);
                const x = Math.cos(currentTheta * Math.PI / 180);
                const y = Math.sin(currentTheta * Math.PI / 180);

                // Texture Selection (The Switch)
                const matKey = x >= 0 ? 
                    Dictionary.nouns[t < 0.5 ? nSel1.value : nSel2.value].material : 
                    Dictionary.nouns[t < 0.5 ? nSel1.value : nSel2.value].material;
                // Simplified: use end noun material if past halfway
                const activeMat = Dictionary.materials[t < 0.5 ? n1.material : n2.material];
                
                const psi = y + activeMat(now / 100);

                // Update Visuals
                document.getElementById('light').style.opacity = (psi + 1.5) / 3;
                document.getElementById('light').style.boxShadow = `0 0 ${((psi + 1.5) * 20)}px #fff`;
                document.getElementById('box').style.transform = `translateY(${psi * 20}px)`;

                // Update Chart
                chart.data.datasets[0].data.push(psi);
                if (chart.data.datasets[0].data.length > 100) chart.data.datasets[0].data.shift();
                chart.update();

                if (t < 1) animationId = requestAnimationFrame(animate);
            }
            chart.data.datasets[0].data = [];
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
