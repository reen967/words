<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UARL | Robot Architect & Sentence Builder</title>
    <style>
        :root { --blue: #0066ff; --bg: #0a0a0a; --panel: #161616; --accent: #00ff41; --text: #ddd; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Sidebar Styles */
        #architect { width: 400px; background: var(--panel); border-right: 1px solid #333; padding: 30px; overflow-y: auto; }
        .comp-card { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #333; display: flex; align-items: center; gap: 10px; }
        .comp-card:hover { border-color: var(--blue); }
        
        /* Main Output Styles */
        #workspace { flex-grow: 1; display: flex; flex-direction: column; background: #050505; }
        #sentence-builder { height: 200px; border-bottom: 1px solid #333; padding: 30px; background: #0c0c0c; }
        #dictionary-view { flex-grow: 1; padding: 30px; overflow-y: auto; font-family: 'Fira Code', 'Courier New', monospace; color: var(--accent); font-size: 13px; }
        
        /* UI Components */
        .btn { width: 100%; padding: 15px; background: var(--blue); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-download { background: #222; border: 1px solid #444; margin-top: 10px; }
        .tag { background: #333; padding: 6px 12px; border-radius: 4px; font-size: 0.75rem; color: var(--blue); border: 1px solid var(--blue); margin-right: 5px; display: inline-block; }
        .verb-tag { color: #ff9900; border-color: #ff9900; }
        h1 { font-size: 1.2rem; margin-bottom: 20px; color: #fff; }
        h2 { font-size: 0.8rem; text-transform: uppercase; color: #666; letter-spacing: 1px; }
        
        pre { white-space: pre-wrap; word-wrap: break-word; }
        .effort-bar { height: 4px; background: #333; width: 100%; margin-top: 8px; border-radius: 2px; position: relative; }
        .effort-fill { height: 100%; background: var(--blue); border-radius: 2px; }
    </style>
</head>
<body>

<aside id="architect">
    <h1>1. Define Capability</h1>
    <p style="font-size: 0.85rem; color: #888;">Select the components available to this robot. UARL will normalize effort (0-100%) for each.</p>
    
    <div class="input-group">
        <div class="comp-card">
            <input type="checkbox" id="wheels" checked>
            <div><strong>Wheels / Locomotion</strong><br><small>Vectors: Velocity + Steering</small></div>
        </div>
        <div class="comp-card">
            <input type="checkbox" id="tilt" checked>
            <div><strong>Tilt / Gaze</strong><br><small>Vectors: Pitch + Yaw</small></div>
        </div>
        <div class="comp-card">
            <input type="checkbox" id="volume">
            <div><strong>Acoustic / Sound</strong><br><small>Vectors: Amplitude + Pitch</small></div>
        </div>
        <div class="comp-card">
            <input type="checkbox" id="light">
            <div><strong>Luminosity / LED</strong><br><small>Vectors: Brightness + Hue</small></div>
        </div>
    </div>

    <h1>2. Compile Language</h1>
    <button class="btn" onclick="compileRobotDictionary()">GENERATE UNIQUE DICTIONARY</button>
    <button class="btn btn-download" onclick="downloadDictionary()">DOWNLOAD JSON PACKAGE</button>
</aside>

<main id="workspace">
    <section id="sentence-builder">
        <h2>Sentence Construction Preview</h2>
        <div style="margin: 20px 0;">
            <span class="tag">I_AM_ALIVE</span> 
            <span style="color:#555">⮕</span> <span class="tag verb-tag">SNAP (t²)</span> 
            <span style="color:#555">⮕</span> <span class="tag">I_SEE_YOU</span> 
            <span style="color:#555">⮕</span> <span class="tag verb-tag">SURGE (t⁴)</span> 
            <span style="color:#555">⮕</span> <span class="tag">APPROACHING</span>
        </div>
        <p id="sentence-logic" style="color: #888; font-size: 0.85rem;">
            // Result: 15% Idle Pulse → Immediate 85% Tracking Lock → Exponential 95% Looming Attack.
        </p>
    </section>

    <section id="dictionary-view">
        <pre id="output-json">// Waiting for architecture selection...</pre>
    </section>
</main>

<script src="../core/affective_data.js"></script>
<script src="../core/uarl_compiler.js"></script>
<script src="../core/uarl_trajectories.js"></script>

<script>
    // Local data for operational words
    const OPERATIONAL_WORDS = [
        { name: "I_AM_ALIVE", angle: 330, p: 0.30, description: "Baseline biological vitality" },
        { name: "I_SEE_YOU", angle: 90, p: 0.85, description: "Directed intentional lock" },
        { name: "APPROACHING", angle: 120, p: 0.95, description: "Looming vector toward human" },
        { name: "YIELDING", angle: 240, p: 0.45, description: "Decelerating space withdrawal" }
    ];

    let compiledDict = null;

    function compileRobotDictionary() {
        const selectedComponents = [];
        if(document.getElementById('wheels').checked) selectedComponents.push('wheels');
        if(document.getElementById('tilt').checked) selectedComponents.push('tilt');
        if(document.getElementById('volume').checked) selectedComponents.push('volume');
        if(document.getElementById('light').checked) selectedComponents.push('light');

        if(selectedComponents.length === 0) return alert("Select at least one capability.");

        // Combine Affective Data + Operational Words
        const fullWordSet = [...OPERATIONAL_WORDS, ...AFFECTIVE_DATA];

        compiledDict = {
            metadata: {
                engine: "UARL Normalized Architecture",
                version: "2.1",
                normalization: "Relative Effort (0.0 - 1.0)"
            },
            blocks: fullWordSet.map(word => {
                let block = {
                    word: word.name,
                    psychophysical_vector: { theta: word.angle, p: word.p },
                    components: {}
                };

                selectedComponents.forEach(comp => {
                    // This logic is mirrored from uarl_compiler.js for direct UI feedback
                    const exponents = { wheels: 1.1, tilt: 1.0, volume: 0.6, light: 0.33 };
                    const effort = Math.pow(word.p, 1 / exponents[comp]);
                    
                    block.components[comp] = {
                        max_effort: (effort * 100).toFixed(1) + "%",
                        verb_trajectory: getVerbPath(word.angle),
                        jitter_variance: ((1 - word.p) * 5).toFixed(1) + "%"
                    };

                    if(comp === 'wheels') {
                        block.components[comp].steering_intent = getWheelDirection(word.angle);
                    }
                });

                return block;
            })
        };

        document.getElementById('output-json').textContent = JSON.stringify(compiledDict, null, 2);
    }

    function getVerbPath(angle) {
        if (angle > 45 && angle < 135) return "SNAP (t²)";
        if (angle >= 135 && angle < 225) return "STOCHASTIC (Jitter)";
        if (angle >= 225 && angle < 315) return "YIELD (√t)";
        return "SURGE (t⁴)";
    }

    function getWheelDirection(angle) {
        if (angle < 180) return "Orient 0° (Human Face-on)";
        return "Orient 180° (Human Escape/Withdraw)";
    }

    function downloadDictionary() {
        if(!compiledDict) return alert("Please compile the dictionary first.");
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(compiledDict, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "uarl_robot_lang.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
</script>
</body>
</html>
